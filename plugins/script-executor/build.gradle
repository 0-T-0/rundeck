import org.apache.tools.ant.filters.ReplaceTokens

apply plugin: 'java'
sourceCompatibility = 1.5
version = '1.2.0'
archivesBaseName = 'rundeck-script-executor-plugin'
defaultTasks 'clean','assemble'
rdPluginName="script-executor"
repositories {
    mavenCentral()
    add(new org.apache.ivy.plugins.resolver.FileSystemResolver()) {
        name = 'localdeps'
        //addIvyPattern "$projectDir/../dependencies/[organisation]/[module]-ivy-[revision].xml"
        addArtifactPattern "$projectDir/../../build/localrepo/[module]/[ext]s/[module]-[revision](-[classifier]).[ext]"
        descriptor = 'optional'
        checkmodified = true
    }
}
dependencies {
    compile( 
        //[group: 'ant', name: 'ant', version: '1.8.1',ext:'jar'],
        //[group: 'ant-launcher', name: 'ant-launcher', version: '1.8.1',ext:'jar'],
        [group: 'rundeck-core',name:'rundeck-core',version: version]
    )
    testCompile(
        [group: 'junit', name: 'junit', version: '3.8.1',ext:'jar']
    )
}

jar {
    manifest {
        attributes 'Rundeck-Plugin-Name': rdPluginName, 'Rundeck-Service-Name': 'NodeExecutor'
    }
}
sourceSets {
    main {
        /*java {
            srcDir 'src/java'
        }
        resources {
            srcDirs =['src/resources','src/java']
        }*/
    }
    test {
       /*
        java {
            srcDir 'src/test'
        }
        resources {
            srcDirs = ['src/resources','src/test']
        }*/
    }
}

test{
    //systemProperties 'rdeck.base': "$projectDir/build/rdeck_base"
    //systemProperties 'rdeck.home': "$projectDir/build"
}


uploadArchives {
    repositories {
       flatDir(dirs: file('repos'))
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '0.9-rc-3'
    jarPath = 'wrapper'
}